function Route(e,n,o,a){let r=t=>document.querySelector(t),l=history,i="",s=e.templates,d=r(e.render),u=r("title"),c=(t,e)=>t.split(e),m=(t,e)=>(d.innerHTML=e.join(""),u.innerHTML=t),f=(t,n,r)=>{let[p,h]=c(t,"?");p!=i&&fetch(e.prot+e.host+p+(h?"?"+h:"")).then(t=>t.json()).then(e=>{let h=c(p,"/");!n&&(r=a),!s[n]&&(r=n,n=o),l.pushState({t:n,h:r,d:Array.isArray(e)?e:e[h[0]]},"",location.origin+"/"+h[0]);let d=l.state;m(d.h,d.d.map(s[d.t])),i=t[0]})},g=(t,e)=>e?localStorage.setItem(t,e):localStorage.getItem(t);return g("p")&&e.openLast?(p=g("p"),t=g("t"),h=g("h"),f(p,t,h)):(l.replaceState({t:o,h:a||"",d:n},"",""),n&&m(a,n.map(s[o]))),window.addEventListener("popstate",t=>{let e=t.state;m(e.h,e.d.map(s[e.t]))}),!e.unload&&(window.onbeforeunload=(()=>!0)),function(t,n,o){t.preventDefault();let a=t.target.getAttribute("href");e.openLast&&(g("p",a),g("t",n),g("h",o)),f(a,n,o)}}